<div class="admin-container">
  <header class="admin-header">
    <div class="logo-area">
      <span class="icon-logo">
        <app-icon name="ShieldCheck"></app-icon>
      </span>
      <h1>Panel de Administración</h1>
    </div>
  </header>

  <div class="tabs-container">
    <button
      class="tab-btn"
      [class.active]="vistaActual === 'empresas'"
      (click)="cambiarVista('empresas')"
    >
      <app-icon name="Building"></app-icon>
      <span>Empresas</span>
    </button>
    <button
      class="tab-btn"
      [class.active]="vistaActual === 'vacantes'"
      (click)="cambiarVista('vacantes')"
    >
      <app-icon name="Briefcase"></app-icon>
      <span>Vacantes</span>
    </button>
    <button
      class="tab-btn"
      [class.active]="vistaActual === 'usuarios'"
      (click)="cambiarVista('usuarios')"
    >
      <app-icon name="Users"></app-icon>
      <span>Usuarios</span>
    </button>
  </div>

  <div class="summary-cards" *ngIf="!loading">
    <div class="summary-card empresas" *ngIf="vistaActual === 'empresas'">
      <div class="card-header-row">
        <div class="card-icon">
          <app-icon name="Building"></app-icon>
        </div>
        <div class="card-content">
          <h3>{{ resumenEmpresas.total }}</h3>
          <p>Total de Empresas</p>
        </div>
      </div>
      <div class="card-stats">
        <div class="stat-item">
          <app-icon name="CheckCircle" class="stat-icon success"></app-icon>
          <div>
            <span class="stat-value">{{ resumenEmpresas.validadas }}</span>
            <span class="stat-label">Validadas</span>
          </div>
        </div>
        <div class="stat-divider"></div>
        <div class="stat-item">
          <app-icon name="Clock" class="stat-icon warning"></app-icon>
          <div>
            <span class="stat-value">{{ resumenEmpresas.pendientes }}</span>
            <span class="stat-label">Pendientes</span>
          </div>
        </div>
      </div>
    </div>

    <div class="summary-card vacantes" *ngIf="vistaActual === 'vacantes'">
      <div class="card-header-row">
        <div class="card-icon">
          <app-icon name="Briefcase"></app-icon>
        </div>
        <div class="card-content">
          <h3>{{ resumenVacantes.total }}</h3>
          <p>Total de Vacantes</p>
        </div>
      </div>
      <div class="card-stats">
        <div class="stat-item">
          <app-icon name="CheckCircle" class="stat-icon success"></app-icon>
          <div>
            <span class="stat-value">{{ resumenVacantes.aprobadas }}</span>
            <span class="stat-label">Aprobadas</span>
          </div>
        </div>
        <div class="stat-divider"></div>
        <div class="stat-item">
          <app-icon name="Clock" class="stat-icon warning"></app-icon>
          <div>
            <span class="stat-value">{{ resumenVacantes.pendientes }}</span>
            <span class="stat-label">Pendientes</span>
          </div>
        </div>
        <div class="stat-divider"></div>
        <div class="stat-item">
          <app-icon name="XCircle" class="stat-icon danger"></app-icon>
          <div>
            <span class="stat-value">{{ resumenVacantes.rechazadas }}</span>
            <span class="stat-label">Rechazadas</span>
          </div>
        </div>
      </div>
    </div>

    <div class="summary-card usuarios" *ngIf="vistaActual === 'usuarios'">
      <div class="card-header-row">
        <div class="card-icon">
          <app-icon name="Users"></app-icon>
        </div>
        <div class="card-content">
          <h3>{{ resumenUsuarios.total }}</h3>
          <p>Total de Usuarios</p>
        </div>
      </div>
      <div class="card-stats">
        <div class="stat-item">
          <app-icon name="AcademicCap" class="stat-icon info"></app-icon>
          <div>
            <span class="stat-value">{{ resumenUsuarios.estudiantes }}</span>
            <span class="stat-label">Estudiantes</span>
          </div>
        </div>
        <div class="stat-divider"></div>
        <div class="stat-item">
          <app-icon name="Building" class="stat-icon warning"></app-icon>
          <div>
            <span class="stat-value">{{ resumenUsuarios.empresas }}</span>
            <span class="stat-label">Empresas</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="table-card">
    <div *ngIf="loading" class="loading">
      <div class="spinner"></div>
      <p>Cargando datos...</p>
    </div>
    <table class="modern-table" *ngIf="!loading && vistaActual === 'empresas'">
      <thead>
        <tr>
          <th>Empresa</th>
          <th>Contacto</th>
          <th>Estado</th>
          <th style="text-align: right">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let emp of empresas">
          <td>
            <div class="info-cell">
              <strong>{{ emp.nombre_empresa }}</strong>
              <small>{{ emp.razon_social }}</small>
            </div>
          </td>
          <td>
            <div class="info-cell">
              <span>{{ emp.email_contacto }}</span>
              <small>{{ emp.sitio_web }}</small>
            </div>
          </td>
          <td>
            <span
              class="badge"
              [class.pending]="emp.validada === 0"
              [class.valid]="emp.validada === 1"
              [class.rejected]="emp.validada === 2"
            >
              {{ emp.validada === 0 ? 'Pendiente' : emp.validada === 1 ? 'Activa' : 'Desactivada' }}
            </span>
          </td>
          <td style="text-align: right">
            <div class="actions-row">
              <ng-container *ngIf="emp.validada === 0">
                <button
                  class="btn-icon btn-approve"
                  title="Aprobar"
                  (click)="toggleValidacion(emp)"
                >
                  <app-icon name="Check"></app-icon>
                </button>
                <button
                  class="btn-icon btn-reject"
                  title="Rechazar (Eliminar)"
                  (click)="rechazarEmpresa(emp)"
                >
                  <app-icon name="XMark"></app-icon>
                </button>
              </ng-container>

              <button
                *ngIf="emp.validada === 1"
                class="btn-icon btn-delete"
                title="Desactivar"
                (click)="toggleValidacion(emp)"
              >
                <app-icon name="NoSymbol"></app-icon>
              </button>

              <button
                *ngIf="emp.validada === 2"
                class="btn-icon btn-approve"
                title="Reactivar"
                (click)="toggleValidacion(emp)"
              >
                <app-icon name="ArrowPath"></app-icon>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <table class="modern-table" *ngIf="!loading && vistaActual === 'usuarios'">
      <thead>
        <tr>
          <th>Estudiante</th>
          <th>Contacto</th>
          <th>Fecha Registro</th>
          <th style="text-align: right">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of usuarios">
          <td>
            <div class="info-cell">
              <strong>{{ user.nombre }} {{ user.apellido }}</strong>
              <small *ngIf="user.fecha_nacimiento">
                <app-icon name="Cake" class="inline-icon"></app-icon>
                {{ formatearFecha(user.fecha_nacimiento) }}
              </small>
            </div>
          </td>
          <td>
            <div class="info-cell">
              <span>{{ user.email }}</span>
              <small *ngIf="user.telefono">
                <app-icon name="Phone" class="inline-icon"></app-icon>
                {{ user.telefono }}
              </small>
            </div>
          </td>
          <td>{{ formatearFecha(user.fecha_registro) }}</td>
          <td style="text-align: right">
            <button
              class="btn-icon btn-delete"
              title="Eliminar estudiante"
              (click)="eliminarUsuario(user)"
            >
              <app-icon name="Trash"></app-icon>
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <table class="modern-table" *ngIf="!loading && vistaActual === 'vacantes'">
      <thead>
        <tr>
          <th>
            <div class="th-content">
              <app-icon name="Briefcase"></app-icon>
              <span>Puesto</span>
            </div>
          </th>
          <th>
            <div class="th-content">
              <app-icon name="Calendar"></app-icon>
              <span>Fecha</span>
            </div>
          </th>
          <th>
            <div class="th-content">
              <app-icon name="Flag"></app-icon>
              <span>Estado</span>
            </div>
          </th>
          <th style="text-align: right">
            <div class="th-content" style="justify-content: flex-end">
              <app-icon name="Cog"></app-icon>
              <span>Moderación</span>
            </div>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let v of vacantes">
          <td>
            <div class="info-cell">
              <strong>{{ v.titulo_cargo }}</strong>
              <small>{{ v.nombre_empresa }}</small>
            </div>
          </td>
          <td>{{ v.fecha_publicacion | date : 'shortDate' }}</td>
          <td>
            <span
              class="badge"
              [class.pending]="v.estado_aprobacion === 'PENDIENTE'"
              [class.valid]="v.estado_aprobacion === 'APROBADA'"
              [class.rejected]="v.estado_aprobacion === 'RECHAZADA'"
            >
              {{ v.estado_aprobacion }}
            </span>
          </td>
          <td style="text-align: right">
            <div class="actions-row">
              <button
                *ngIf="v.estado_aprobacion !== 'APROBADA'"
                class="btn-icon btn-approve"
                title="Aprobar"
                (click)="moderarVacante(v.id_vacante, 'APROBADA')"
              >
                <app-icon name="Check"></app-icon>
              </button>
              <button
                *ngIf="v.estado_aprobacion === 'PENDIENTE'"
                class="btn-icon btn-reject"
                title="Rechazar"
                (click)="moderarVacante(v.id_vacante, 'RECHAZADA')"
              >
                <app-icon name="XMark"></app-icon>
              </button>
              <button
                class="btn-icon btn-delete"
                title="Eliminar"
                (click)="eliminarVacante(v.id_vacante)"
              >
                <app-icon name="Trash"></app-icon>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <table class="modern-table" *ngIf="!loading && vistaActual === 'usuarios'">
      <thead>
        <tr>
          <th>
            <div class="th-content">
              <app-icon name="User"></app-icon>
              <span>Usuario</span>
            </div>
          </th>
          <th>
            <div class="th-content">
              <app-icon name="AtSymbol"></app-icon>
              <span>Contacto</span>
            </div>
          </th>
          <th>
            <div class="th-content">
              <app-icon name="Tag"></app-icon>
              <span>Tipo</span>
            </div>
          </th>
          <th>
            <div class="th-content">
              <app-icon name="Calendar"></app-icon>
              <span>Fecha de Registro</span>
            </div>
          </th>
          <th style="text-align: right">
            <div class="th-content" style="justify-content: flex-end">
              <app-icon name="Cog"></app-icon>
              <span>Acciones</span>
            </div>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of usuarios">
          <td>
            <div class="info-cell">
              <strong *ngIf="user.tipo_usuario === 'ESTUDIANTE'">
                {{ user.nombre }} {{ user.apellido }}
              </strong>
              <strong *ngIf="user.tipo_usuario === 'EMPRESA'">
                {{ user.nombre }}
              </strong>
              <small *ngIf="user.fecha_nacimiento">
                <app-icon name="Cake" class="inline-icon"></app-icon>
                {{ formatearFecha(user.fecha_nacimiento) }}
              </small>
            </div>
          </td>
          <td>
            <div class="info-cell">
              <span>{{ user.email }}</span>
              <small *ngIf="user.telefono">
                <app-icon name="Phone" class="inline-icon"></app-icon>
                {{ user.telefono }}
              </small>
            </div>
          </td>
          <td>
            <span
              class="badge"
              [class.valid]="user.tipo_usuario === 'ESTUDIANTE'"
              [class.pending]="user.tipo_usuario === 'EMPRESA'"
            >
              <app-icon
                [name]="user.tipo_usuario === 'ESTUDIANTE' ? 'AcademicCap' : 'Building'"
                class="badge-icon"
              >
              </app-icon>
              {{ user.tipo_usuario }}
            </span>
          </td>
          <td>{{ formatearFecha(user.fecha_registro) }}</td>
          <td style="text-align: right">
            <button
              class="btn-icon btn-delete"
              title="Eliminar usuario"
              (click)="eliminarUsuario(user)"
            >
              <app-icon name="Trash"></app-icon>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
