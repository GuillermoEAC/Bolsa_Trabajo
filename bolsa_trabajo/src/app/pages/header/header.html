<header class="main-header">
  <div class="logo-container">
    <img
      src="assets/img/Logo_Completo.png"
      alt="Primer Paso Logo"
      routerLink="/welcome"
      class="img-logo"
    />
  </div>

  <div class="header-actions">
    <ng-container *ngIf="!currentUser">
      <a class="link-empresa" routerLink="/registro-empresa">Soy Empresa</a>
      <a class="button crear-cv" routerLink="/cv-builder">Crear CV</a>
      <button class="button login-btn" (click)="openLogin()">Login</button>
    </ng-container>

    <ng-container *ngIf="currentUser">
      <div class="user-controls">
        <div class="notification-container">
          <button class="icon-btn" (click)="toggleNotifications()" title="Notificaciones">
            <span style="font-size: 1.3rem">üîî</span>
            <span *ngIf="noLeidasCount > 0" class="badge-count">{{ noLeidasCount }}</span>
          </button>

          <div *ngIf="showNotifications" class="noti-dropdown">
            <div class="noti-header">
              <span>Notificaciones</span>
              <button
                *ngIf="notificaciones.length > 0"
                (click)="showNotifications = false"
                class="close-noti"
              >
                <app-icon name="XMark"></app-icon>
              </button>
            </div>
            <div class="noti-list">
              <div *ngIf="notificaciones.length === 0" class="noti-empty">
                No tienes notificaciones nuevas.
              </div>
              <div
                *ngFor="let noti of notificaciones"
                class="noti-item"
                [class.unread]="!noti.leida"
              >
                <div
                  class="noti-icon"
                  [class.success]="noti.tipo === 'EXITO'"
                  [class.info]="noti.tipo === 'INFO'"
                >
                  <app-icon *ngIf="noti.tipo === 'EXITO'" name="Check"></app-icon>
                  <app-icon *ngIf="noti.tipo !== 'EXITO'" name="InformationCircle"></app-icon>
                </div>
                <div class="noti-content">
                  <p>{{ noti.mensaje }}</p>
                  <small>{{ noti.fecha_creacion | date : 'short' }}</small>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="profile-dropdown-container">
          <div class="user-profile" (click)="toggleMenu()">
            <span class="user-name">{{ currentUser.email.split('@')[0] }}</span>
            <div class="user-avatar">
              {{ currentUser.email[0] | uppercase }}
            </div>
            <div class="dropdown-arrow-icon">
              <app-icon name="ChevronDown"></app-icon>
            </div>
          </div>

          <div *ngIf="isMenuOpen" class="dropdown-menu">
            <div class="dropdown-header-text">
              Hola, <strong>{{ currentUser.email.split('@')[0] }}</strong>
              <div class="role-badge">{{ getTipoUsuario() }}</div>
            </div>

            <ng-container *ngIf="esEstudiante()">
              <button class="dropdown-item" (click)="navegarAlPerfil()">
                <span class="menu-icon"><app-icon name="User"></app-icon></span>
                Mi Perfil
              </button>
              <a routerLink="/mis-postulaciones" class="dropdown-item" (click)="isMenuOpen = false">
                <span class="menu-icon"><app-icon name="Briefcase"></app-icon></span>
                Mis Postulaciones
              </a>
              <a routerLink="/mis-favoritos" class="dropdown-item" (click)="isMenuOpen = false">
                <span class="menu-icon">‚ù§Ô∏è</span>
                Mis Favoritos
              </a>
              <div class="dropdown-divider"></div>
            </ng-container>

            <ng-container *ngIf="esEmpresa()">
              <a routerLink="/dashboard-empresa" class="dropdown-item" (click)="isMenuOpen = false">
                <span class="menu-icon"><app-icon name="ChartBar"></app-icon></span>
                Dashboard
              </a>
              <a routerLink="/mis-vacantes" class="dropdown-item" (click)="isMenuOpen = false">
                <span class="menu-icon"><app-icon name="Building"></app-icon></span>
                Mis Vacantes
              </a>
              <a routerLink="/publicar-vacante" class="dropdown-item" (click)="isMenuOpen = false">
                <span class="menu-icon"><app-icon name="Plus"></app-icon></span>
                Publicar Vacante
              </a>
              <div class="dropdown-divider"></div>
            </ng-container>

            <ng-container *ngIf="esAdmin()">
              <a routerLink="/admin" class="dropdown-item" (click)="isMenuOpen = false">
                <span class="menu-icon"><app-icon name="ShieldCheck"></app-icon></span>
                Panel Admin
              </a>
              <div class="dropdown-divider"></div>
            </ng-container>

            <button class="dropdown-item text-danger" (click)="logout()">
              <span class="menu-icon"><app-icon name="Logout"></app-icon></span>
              Cerrar Sesi√≥n
            </button>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
</header>

<app-login [isVisible]="isModalVisible" (close)="closeLogin()"></app-login>
